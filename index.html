<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Supabase Chat</title>
<style>
  body { font-family: Arial; max-width: 400px; margin: 20px auto; background: #f0f0f0; }
  #chatBox { border: 1px solid #ccc; height: 400px; overflow-y: scroll; background: white; padding: 10px; margin-bottom: 10px; }
  .message { margin: 5px 0; padding: 8px; border-radius: 5px; max-width: 70%; }
  .user { background: #0078ff; color: white; margin-left: auto; text-align: right; }
  .other { background: #ddd; color: #333; margin-right: auto; }
  #inputForm { display: flex; }
  #messageInput { flex: 1; padding: 10px; font-size: 16px; }
  #sendBtn { padding: 10px 15px; background: #0078ff; border: none; color: white; cursor: pointer; font-size: 16px; }
</style>
</head>
<body>
<h2>Supabase Chat</h2>
<div id="chatBox"></div>
<form id="inputForm">
  <input type="text" id="messageInput" autocomplete="off" placeholder="Schreib was..." required />
  <button type="submit" id="sendBtn">Senden</button>
</form>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
  // Hier deine Supabase-URL & Key rein
  const SUPABASE_URL = 'https://ujhhlaldweroyhpwwcpe.supabase.co';
  const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVqaGhsYWxkd2Vyb3locHd3Y3BlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTI1NzQzMDQsImV4cCI6MjA2ODE1MDMwNH0.NshCCxYvWgCQIYv4NWAPINYflNhcRAZFH1V65wFA9UA';

  const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

  const chatBox = document.getElementById('chatBox');
  const inputForm = document.getElementById('inputForm');
  const messageInput = document.getElementById('messageInput');

  // Einfacher User-Name (random)
  const userId = 'user_' + Math.floor(Math.random() * 1000);

  // Nachrichten laden & anzeigen
  async function loadMessages() {
    const { data, error } = await supabase
      .from('messages')
      .select('*')
      .order('inserted_at', { ascending: true })
      .limit(100);
    if (error) console.error(error);
    chatBox.innerHTML = '';
    data.forEach(msg => {
      const div = document.createElement('div');
      div.textContent = msg.text;
      div.classList.add('message');
      div.classList.add(msg.sender === userId ? 'user' : 'other');
      chatBox.appendChild(div);
    });
    chatBox.scrollTop = chatBox.scrollHeight;
  }

  loadMessages();

  // Echtzeit abonnieren
  supabase
    .channel('public:messages')
    .on('postgres_changes', { event: 'INSERT', schema: 'public', table: 'messages' }, payload => {
      const msg = payload.new;
      const div = document.createElement('div');
      div.textContent = msg.text;
      div.classList.add('message');
      div.classList.add(msg.sender === userId ? 'user' : 'other');
      chatBox.appendChild(div);
      chatBox.scrollTop = chatBox.scrollHeight;
    })
    .subscribe();

  // Neue Nachricht senden
  inputForm.addEventListener('submit', async e => {
    e.preventDefault();
    const text = messageInput.value.trim();
    if (!text) return;
    const { error } = await supabase.from('messages').insert([{ sender: userId, text }]);
    if (error) console.error(error);
    messageInput.value = '';
  });
</script>
</body>
</html>
